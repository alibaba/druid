<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>Druid Web URI Stat</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf8" />
		<link href='css/bootstrap.min.css' rel="stylesheet" />
		<link href="css/style.css" type="text/css" rel="stylesheet"/>
    	<script type="text/javascript" src="js/jquery.min.js"></script>
		<script src="js/common.js" type="text/javascript" charset="utf8"></script>
	</head>
	<body>
		<div class="container-fluid">
      		<div class="row-fluid">
        		<div class="span12">
          				<h3>
          					Web URI Stat
          				</h3>
						<table id="dataTable" class="table table-bordered responsive-utilities">
							<thead>
								<tr>
									<th class="yellow header">N--</th>
									<th class="yellow header"><a id="th-URI" href="javascript:void(0)" onclick="druid.common.setOrderBy('URI');">URI</a></th>
									<th class="yellow header" width="50"><a id="th-RequestCount" href="javascript:void(0)" onclick="druid.common.setOrderBy('RequestCount');">Request Count</a></th>
									<th class="yellow header" width="50"><a id="th-RequestTimeMillis" href="javascript:void(0)" onclick="druid.common.setOrderBy('RequestTimeMillis');">Request Time</a></th>
									<th class="yellow header" width="50"><a id="th-RunningCount" href="javascript:void(0)" onclick="druid.common.setOrderBy('RunningCount');">Running Count</a></th>
									<th class="yellow header" width="50"><a id="th-ConcurrentMax" href="javascript:void(0)" onclick="druid.common.setOrderBy('ConcurrentMax');">Concurrent Max</a></th>
									<th class="yellow header" width="50"><a id="th-JdbcExecuteCount" href="javascript:void(0)" onclick="druid.common.setOrderBy('JdbcExecuteCount');">Jdbc Exec Count</a></th>
									<th class="yellow header" width="50"><a id="th-JdbcExecuteTimeMillis" href="javascript:void(0)" onclick="druid.common.setOrderBy('JdbcExecuteTimeMillis');">Jdbc Exec Time</a></th>
									<th class="yellow header" width="50"><a id="th-JdbcCommitCount" href="javascript:void(0)" onclick="druid.common.setOrderBy('JdbcCommitCount');">Jdbc Commit</a></th>
									<th class="yellow header" width="50"><a id="th-JdbcRollbackCount" href="javascript:void(0)" onclick="druid.common.setOrderBy('JdbcRollbackCount');">Jdbc Rollback</a></th>
									<th class="yellow header" width="50"><a id="th-JdbcFetchRowCount" href="javascript:void(0)" onclick="druid.common.setOrderBy('JdbcFetchRowCount');">Jdbc FetchRow</a></th>
									<th class="yellow header" width="50"><a id="th-JdbcUpdateCount" href="javascript:void(0)" onclick="druid.common.setOrderBy('JdbcUpdateCount');">Jdbc Update</a></th>
								</tr>
							</thead> 
							<tbody></tbody>
						</table>
        		</div>
      		</div> 
    	</div>
    	<script type="text/javascript">
    	$.namespace("druid.weburi");
    	druid.weburi = function () {  
    		return  {
    			init : function() {
    				druid.common.buildHead(3);
    				druid.common.ajaxuri = 'weburi.json?';
    				druid.common.handleAjaxResult = druid.weburi.handleAjaxResult;
    				druid.common.setOrderBy("URI");
    				druid.common.ajaxRequestForBasicInfo();
    				setInterval("druid.common.ajaxRequestForBasicInfo();",5000);
    			},
    			
    			handleAjaxResult : function(data) {
    				var statList = data.Content;
    				if(statList == null) return;
    				
    				var sqlStatTable = document.getElementById("dataTable");
    				while (sqlStatTable.rows.length > 1) {
    					sqlStatTable.deleteRow(1);
    				}

    				var html = "";
    				for ( var i = 0; i < statList.length; i++) {
    					var stat = statList[i];
    					var newRow = sqlStatTable.insertRow(-1);
    					html += "<tr>";
    					html += "<td>" + (i + 1) + "</td>";
    					html += "<td>" + '<a target="_blank" href="weburi-detail.html?uri='+ encodeURI(stat.URI) + '">' + druid.common.subSqlString(stat.URI, 64) + '</a>' + "</td>";
    					html += "<td>" + stat.RequestCount + "</td>";
    					html += "<td>" + stat.RequestTimeMillis + "</td>";
    					html += "<td>" + stat.RunningCount + "</td>";
    					html += "<td>" + stat.ConcurrentMax + "</td>";
    					html += "<td>" + stat.JdbcExecuteCount + "</td>";
    					html += "<td>" + stat.JdbcExecuteTimeMillis + "</td>";
    					html += "<td>" + stat.JdbcCommitCount + "</td>";
    					html += "<td>" + stat.JdbcRollbackCount + "</td>";
    					html += "<td>" + stat.JdbcFetchRowCount + "</td>";
    					html += "<td>" + stat.JdbcUpdateCount + "</td>";
    					html += "</tr>";
    				}
    				$("#dataTable tbody").html(html);
    				druid.common.stripes();
    			}
    		}
    	}();

    	$(document).ready(function() {
    		druid.weburi.init();
    	});
    	</script>
	</body>
</html>
