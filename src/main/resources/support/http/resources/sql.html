<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<title>Druid SQL Stat</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf8" />
		<link href='css/bootstrap.min.css' rel="stylesheet" />
		<link href="css/style.css" type="text/css" rel="stylesheet"/>
    	<script type="text/javascript" src="js/jquery.min.js"></script>
		<script src="js/common.js" type="text/javascript" charset="utf8"></script>
	</head>
	<body>
		<div class="container-fluid">
      		<div class="row-fluid">
        		<div class="span12">
          			<div class="hero-unit" style="padding: 10px;">
          				<h3>
          					SQL Stat
          				</h3>
						<table id="dataTable" class="table table-bordered table-striped responsive-utilities">
							<thead>
								<tr>
									<th class="td_lable">N--</th>
									<th class="td_lable"><a id="th-SQL" href="javascript:void(0)" onclick="druid.common.setOrderBy('SQL');">SQL</a></th>
									<th class="td_lable" width="50"><a id="th-ExecuteCount" href="javascript:void(0)" onclick="druid.common.setOrderBy('ExecuteCount');">Execute Count</a></th>
									<th class="td_lable" width="50"><a id="th-TotalTime" href="javascript:void(0)" onclick="druid.common.setOrderBy('TotalTime');">Execute Millis Total</a></th>
									<th class="td_lable" width="50"><a id="th-MaxTimespan" href="javascript:void(0)" onclick="druid.common.setOrderBy('MaxTimespan');">Execute Millis Max</a></th>
									<th class="td_lable" width="50"><a id="th-InTransactionCount" title="Execute in transaction Count" href="druid.common.javascript:void(0)" onclick="setOrderBy('InTransactionCount');">InTxn Count</a></th>
									<th class="td_lable" width="50"><a id="th-ErrorCount" href="javascript:void(0)" onclick="druid.common.setOrderBy('ErrorCount');">Error Count</a></th>
									<th class="td_lable" width="50"><a id="th-EffectedRowCount" href="javascript:void(0)" onclick="druid.common.setOrderBy('EffectedRowCount');">Effected Row Count</a></th>
									<th class="td_lable" width="50"><a id="th-FetchRowCount" href="javascript:void(0)" onclick="druid.common.setOrderBy('FetchRowCount');">Fetch Row Count</a></th>
									<th class="td_lable" width="50"><a id="th-RunningCount" href="javascript:void(0)" onclick="druid.common.setOrderBy('RunningCount');">Running Count</a></th>
									<th class="td_lable" width="80"><a id="th-ConcurrentMax" href="javascript:void(0)" onclick="druid.common.setOrderBy('ConcurrentMax');">Concurrent Max</a></th>
									<th id="th-Histogram" class="td_lable" align="left" width="100">ExecHistogram <br />[ 
										<a id="th-Histogram[0]" title="count of '0-1 ms'" href="javascript:void(0)" onclick="druid.common.setOrderBy('Histogram[0]');">-</a>
										<a id="th-Histogram[1]" title="count of '1-10 ms'" href="javascript:void(0)" onclick="druid.common.setOrderBy('Histogram[1]');">-</a>
										<a id="th-Histogram[2]" title="count of '10-100 ms'" href="javascript:void(0)" onclick="druid.common.setOrderBy('Histogram[2]');">-</a>
										<a id="th-Histogram[3]" title="count of '100ms-1 s'" href="javascript:void(0)" onclick="druid.common.setOrderBy('Histogram[3]');">-</a>
										<a id="th-Histogram[4]" title="count of '1-10 s'" href="javascript:void(0)" onclick="druid.common.setOrderBy('Histogram[4]');">-</a>
										<a id="th-Histogram[5]" title="count of '10-100 s'" href="javascript:void(0)" onclick="druid.common.setOrderBy('Histogram[5]');">-</a>
										<a id="th-Histogram[6]" title="count of '100-1000 s'" href="javascript:void(0)" onclick="druid.common.setOrderBy('Histogram[6]');">-</a>
										<a id="th-Histogram[7]" title="count of '> 1000 s'" href="javascript:void(0)" onclick="druid.common.setOrderBy('Histogram[7]');">-</a> ]
									</th>
									<th id="th-ExecuteAndResultHoldTimeHistogram" class="td_lable" align="left" width="100">ExecAndRsHold <br />[ 
										<a id="th-ExecuteAndResultHoldTimeHistogram[0]" title="count of '0-1 ms'" href="javascript:void(0)" onclick="druid.common.setOrderBy('ExecuteAndResultHoldTimeHistogram[0]');">-</a>
										<a id="th-ExecuteAndResultHoldTimeHistogram[1]" title="count of '1-10 ms'" href="javascript:void(0)" onclick="druid.common.setOrderBy('ExecuteAndResultHoldTimeHistogram[1]');">-</a>
										<a id="th-ExecuteAndResultHoldTimeHistogram[2]" title="count of '10-100 ms'" href="javascript:void(0)" onclick="druid.common.setOrderBy('ExecuteAndResultHoldTimeHistogram[2]');">-</a>
										<a id="th-ExecuteAndResultHoldTimeHistogram[3]" title="count of '100ms-1s'" href="javascript:void(0)" onclick="druid.common.setOrderBy('ExecuteAndResultHoldTimeHistogram[3]');">-</a>
										<a id="th-ExecuteAndResultHoldTimeHistogram[4]" title="count of '1-10 s'" href="javascript:void(0)" onclick="druid.common.setOrderBy('ExecuteAndResultHoldTimeHistogram[4]');">-</a>
										<a id="th-ExecuteAndResultHoldTimeHistogram[5]" title="count of '10-100 s'" href="javascript:void(0)" onclick="druid.common.setOrderBy('ExecuteAndResultHoldTimeHistogram[5]');">-</a>
										<a id="th-ExecuteAndResultHoldTimeHistogram[6]" title="count of '100-1000 s'" href="javascript:void(0)" onclick="druid.common.setOrderBy('ExecuteAndResultHoldTimeHistogram[6]');">-</a>
										<a id="th-ExecuteAndResultHoldTimeHistogram[7]" title="count of '> 1000 s'" href="javascript:void(0)" onclick="druid.common.setOrderBy('ExecuteAndResultHoldTimeHistogram[7]');">-</a> ]
									</th>
									<th id="th-FetchRowCountHistogram" class="td_lable" align="left" width="100">FetchRow <br />[ 
										<a id="th-FetchRowCountHistogram[0]" title="count of '0 FetchRow'" href="javascript:void(0)" onclick="druid.common.setOrderBy('FetchRowCountHistogram[0]');">-</a>
										<a id="th-FetchRowCountHistogram[1]" title="count of '1-9 FetchRow'" href="javascript:void(0)" onclick="druid.common.setOrderBy('FetchRowCountHistogram[1]');">-</a>
										<a id="th-FetchRowCountHistogram[2]" title="count of '10-99 FetchRow'" href="javascript:void(0)" onclick="druid.common.setOrderBy('FetchRowCountHistogram[2]');">-</a>
										<a id="th-FetchRowCountHistogram[3]" title="count of '100-999 FetchRow'" href="javascript:void(0)" onclick="druid.common.setOrderBy('FetchRowCountHistogram[3]');">-</a>
										<a id="th-FetchRowCountHistogram[4]" title="count of '1000-9999 FetchRow'" href="javascript:void(0)" onclick="druid.common.setOrderBy('FetchRowCountHistogram[4]');">-</a>
										<a id="th-FetchRowCountHistogram[5]" title="count of '> 9999 FetchRow'" href="javascript:void(0)" onclick="druid.common.setOrderBy('FetchRowCountHistogram[5]');">-</a> ]
									</th>
									<th id="th-EffectedRowCountHistogram" class="td_lable" align="left" width="100">UpdateCount <br />[ 
										<a id="th-EffectedRowCountHistogram[0]" title="count of '0 UpdateCount'" href="javascript:void(0)" onclick="druid.common.setOrderBy('EffectedRowCountHistogram[0]');">-</a>
										<a id="th-EffectedRowCountHistogram[1]" title="count of '1-9 UpdateCount'" href="javascript:void(0)" onclick="druid.common.setOrderBy('EffectedRowCountHistogram[1]');">-</a>
										<a id="th-EffectedRowCountHistogram[2]" title="count of '10-99 UpdateCount'" href="javascript:void(0)" onclick="druid.common.setOrderBy('EffectedRowCountHistogram[2]');">-</a>
										<a id="th-EffectedRowCountHistogram[3]" title="count of '100-999 UpdateCount'" href="javascript:void(0)" onclick="druid.common.setOrderBy('EffectedRowCountHistogram[3]');">-</a>
										<a id="th-EffectedRowCountHistogram[4]" title="count of '1000-9999 UpdateCount'" href="javascript:void(0)" onclick="druid.common.setOrderBy('EffectedRowCountHistogram[4]');">-</a>
										<a id="th-EffectedRowCountHistogram[5]" title="count of '> 9999 UpdateCount'" href="javascript:void(0)" onclick="druid.common.setOrderBy('EffectedRowCountHistogram[5]');">-</a> ]
									</th>
								</tr>
							</thead> 
							<tbody></tbody>
						</table>
          			</div>
        		</div>
      		</div> 
    	</div>
    	<script type="text/javascript">
	    	$.namespace("druid.weburi");
	    	druid.weburi = function () {  
	    		return  {
	    			init : function() {
	    				druid.common.buildHead(2);
	    				druid.common.ajaxuri = 'sql.json?';
	    				druid.common.handleAjaxResult = druid.weburi.handleAjaxResult;
	    				druid.common.setOrderBy("SQL");
	    				druid.common.ajaxRequestForBasicInfo();
	    				setInterval("druid.common.ajaxRequestForBasicInfo();",5000);
	    			},
	    			
	    			handleAjaxResult : function(data) {
	    				var sqlStatList = data.Content;
	    				if(sqlStatList==null) return;
	    				
	    				var sqlStatTable = document.getElementById("dataTable");
	    				while (sqlStatTable.rows.length > 1) {
	    					sqlStatTable.deleteRow(1);
	    				}
	    				
	    				var html = "";
	    				for ( var i = 0; i < sqlStatList.length; i++) {
	    					var stat = sqlStatList[i];
	    					var newRow = sqlStatTable.insertRow(-1);
	    					html += "<tr>";
	    					html += "<td>" + (i + 1) + "</td>";
	    					html += "<td>" + '<a target="_blank" href="sql-detail.html?sqlId=' + stat.ID + '">' + druid.common.subSqlString(stat.SQL, 25) + '</a>' + "</td>";
	    					html += "<td>" + stat.ExecuteCount + "</td>";
	    					html += "<td>" + stat.TotalTime + "</td>";
	    					
	    					var lastSlowHtml = stat.MaxTimespan;
	    					if (stat.LastSlowParameters!=null && stat.LastSlowParameters.length>0) {
	    						lastSlowHtml ='<a target="_blank" style="color:red" href="sql-detail.html?sqlId=' + stat.ID + '">'+stat.MaxTimespan+'</a>';
	    					}
	    					html += "<td>" + lastSlowHtml + "</td>";
	    					html += "<td>" + stat.InTransactionCount + "</td>";
	    					html += "<td>" + stat.ErrorCount + "</td>";
	    					html += "<td>" + stat.EffectedRowCount + "</td>";
	    					html += "<td>" + stat.FetchRowCount + "</td>";
	    					html += "<td>" + stat.RunningCount + "</td>";
	    					html += "<td>" + stat.ConcurrentMax + "</td>";
	    					html += "<td>" + '[' + stat.Histogram + ']' + "</td>";
	    					html += "<td>" + '[' + stat.ExecuteAndResultHoldTimeHistogram + ']' + "</td>";
	    					html += "<td>" + '[' + stat.FetchRowCountHistogram + ']' + "</td>";
	    					html += "<td>" + '[' + stat.EffectedRowCountHistogram + ']' + "</td>";
	    					html += "</tr>";
	    				}
	    				$("#dataTable tbody").html(html);
	    				druid.common.stripes();
	    			}
	    		}
	    	}();
	
	    	$(document).ready(function() {
	    		druid.weburi.init();
	    	});
    	</script>
	</body>
</html>
